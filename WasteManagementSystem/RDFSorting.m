%% RDFSorting Class Definition
% The RDFSorting behavior calculates the useable cRDF anf dRDF extracted 
% from the restwaste output generated by the WasteSorting.m object
% In addition, the amount of residues is calculated, along with the amount
% going to either thermal treatment or landfill (as set by the user)
%
% 17-August, 2011
% Sydney Do, sydneydo@mit.edu
%%
classdef RDFSorting < Behavior
    properties
        restwaste_to_cRDF;              % the restwaste sent to cRDF sorting from the waste sorting facility (ie. from WasteSorting.m) (function input)
        restwaste_to_dRDF;              % the restwaste sent to dRDF sorting from the waste sorting facility (ie. from WasteSorting.m) (function input)
        cRDF_extracted;                 % the amount of cRDF extracted from the RDF Sorting process
        dRDF_extracted;                 % the amount of dRDF extracted from the RDF Sorting process
        screened_materials_to_landfill; % the fraction of the process input that is considered rogue and not able to be processed. This is sent directly to landfill
        fe_metal_recovered;             % ferrous metal recovered from the RDF sorting process. This is sent to materials reprocessors
        nonfe_metal_recovered;          % non-ferrous metal recovered from the RDF sorting process. This is sent to materials reprocessors
        fines_to_biological;            % fines produced from the RDF sorting process sent for biological treatment
        fines_to_landfill;              % fines produced from the RDF sorting process sent to landfill
        residues_to_landfill;           % residues generated from RDF sorting process. These are automatically sent to landfill
    end
    methods
        %% RDFSorting Constructor
        % Instantiates a new RDFSorting object.
        % 
        % obj = RDFSorting()
        %   obj:                            the new RDFSorting object
        %   restwaste_to_cRDF:              the restwaste sent to cRDF sorting from the waste sorting facility (ie. from WasteSorting.m) (function input)
        %   restwaste_to_dRDF:              the restwaste sent to dRDF sorting from the waste sorting facility (ie. from WasteSorting.m) (function input)
        %   cRDF_extracted:                 the amount of cRDF extracted from the RDF Sorting process
        %   dRDF_extracted:                 the amount of dRDF extracted from the RDF Sorting process
        %   screened_materials_to_landfill: the fraction of the process input that is considered rogue and not able to be processed. This is sent directly to landfill
        %   fe_metal_recovered:             ferrous metal recovered from the RDF sorting process. This is sent to materials reprocessors
        %   nonfe_metal_recovered:          non-ferrous metal recovered from the RDF sorting process. This is sent to materials reprocessors
        %   fines_to_biological:            fines produced from the RDF sorting process sent for biological treatment
        %   fines_to_landfill:              fines produced from the RDF sorting process sent to landfill
        %   residues_to_landfill;           residues generated from RDF sorting process. These are automatically sent to landfill
        
        function obj = RDFSorting()
            obj = obj@Behavior('Refuse Derived Fuel Sorting', ...
                'Calculates the outputs of the refuse derived fuel sorting process', ...
                'tonnes','[0,inf)');
        end
    end
    methods(Access=protected)
        %% EvaluateImpl Function
        % Evaluates the behavior for a specified city. Note: the
        % superclass Evaluate function should be used for evaluation during
        % execution.
        %
        % val = obj.EvaluateImpl(city)
        %   val:    the evaluated value
        %   obj:    the TotalResidentialWaste object handle
        function val = EvaluateImpl(obj)      
            
            % Set city identifier
            city = CityNet.instance().city;
            
            % Search for waste system identifier       
            for i = 1:length(city.systems)
                if strcmp(city.systems(i).name,'Waste')==1
                    ind = i;
                    break
                end
            end      
            
            % Search for Materials Sorting Facility Identifier in Waste Layer
            for i = 1:length(city.systems(ind).nodes)
                if strcmp(city.systems(ind).nodes(i).type.name,'Waste Streams Sorting')
                    % Store node ID
                    ind2 = i;
                    break
                end
            end          
            
            % Set Materials Sorting Facility Identifier
            sorting = city.systems(ind).nodes(ind2);
                  
            % Define cRDF variables
            cRDF = cRDFVariables;
            
            % Define dRDF variables
            dRDF = dRDFVariables;
                     
            %% Determine amount of cRDF extracted
            % cRDF = fuel content of each waste stream times (1-rogue item
            % fraction)
            obj.cRDF_extracted = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                sum([obj.restwaste_to_cRDF.paper*cRDF.fuel.paper,...
                obj.restwaste_to_cRDF.glass*cRDF.fuel.glass,...
                obj.restwaste_to_cRDF.fe_metal*cRDF.fuel.fe_metal,...
                obj.restwaste_to_cRDF.nonfe_metal*cRDF.fuel.nonfe_metal,...
                obj.restwaste_to_cRDF.filmplastic*cRDF.fuel.filmplastic,...
                obj.restwaste_to_cRDF.rigidplastic*cRDF.fuel.rigidplastic,...
                obj.restwaste_to_cRDF.textiles*cRDF.fuel.textiles,...
                obj.restwaste_to_cRDF.organics*cRDF.fuel.organics,...
                obj.restwaste_to_cRDF.other*cRDF.fuel.other]);
            
            %% Determine amount of dRDF extracted
            % dRDF = fuel content of each waste stream times (1-rogue item
            % fraction)
            obj.dRDF_extracted = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('dRDFMoistureLoss'))*...
                sum([obj.restwaste_to_dRDF.paper*dRDF.fuel.paper,...
                obj.restwaste_to_dRDF.glass*dRDF.fuel.glass,...
                obj.restwaste_to_dRDF.fe_metal*dRDF.fuel.fe_metal,...
                obj.restwaste_to_dRDF.nonfe_metal*dRDF.fuel.nonfe_metal,...
                obj.restwaste_to_dRDF.filmplastic*dRDF.fuel.filmplastic,...
                obj.restwaste_to_dRDF.rigidplastic*dRDF.fuel.rigidplastic,...
                obj.restwaste_to_dRDF.textiles*dRDF.fuel.textiles,...
                obj.restwaste_to_dRDF.organics*dRDF.fuel.organics,...
                obj.restwaste_to_dRDF.other*dRDF.fuel.other]);            
            
            %% Determine amount of screened materials sent to landfill
            % Calculated by waste stream for both cRDF and dRDF combined
            
            % Paper fraction
            obj.screened_materials_to_landfill.paper = (1-(1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected')))*...
                (obj.restwaste_to_cRDF.paper+obj.restwaste_to_dRDF.paper);
                     
            % Glass fraction
            obj.screened_materials_to_landfill.glass = (1-(1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected')))*...
                (obj.restwaste_to_cRDF.glass+obj.restwaste_to_dRDF.glass);
                        
            % Ferrous Metal fraction
            obj.screened_materials_to_landfill.fe_metal = (1-(1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected')))*...
                (obj.restwaste_to_cRDF.fe_metal+obj.restwaste_to_dRDF.fe_metal);
                        
            % Non-ferrous Metal fraction
            obj.screened_materials_to_landfill.nonfe_metal = (1-(1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected')))*...
                (obj.restwaste_to_cRDF.nonfe_metal+obj.restwaste_to_dRDF.nonfe_metal);
            
            % Film Plastic fraction
            obj.screened_materials_to_landfill.filmplastic = (1-(1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected')))*...
                (obj.restwaste_to_cRDF.filmplastic+obj.restwaste_to_dRDF.filmplastic);
            
            % Rigid Plastic fraction
            obj.screened_materials_to_landfill.rigidplastic = (1-(1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected')))*...
                (obj.restwaste_to_cRDF.rigidplastic+obj.restwaste_to_dRDF.rigidplastic);
            
            % Textiles fraction
            obj.screened_materials_to_landfill.textiles = (1-(1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected')))*...
                (obj.restwaste_to_cRDF.textiles+obj.restwaste_to_dRDF.textiles);
            
            % Organics
            obj.screened_materials_to_landfill.organics = (1-(1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected')))*...
                (obj.restwaste_to_cRDF.organics+obj.restwaste_to_dRDF.organics);
            
            % Other
            obj.screened_materials_to_landfill.other = (1-(1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected')))*...
                (obj.restwaste_to_cRDF.other+obj.restwaste_to_dRDF.other);
            
            %% Determine amount of ferrous metal recovered
            % Calculated by waste stream for both cRDF and dRDF combined
            
            % Paper fraction
            obj.fe_metal_recovered.paper = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.paper*cRDF.fe_metal.paper+...
                obj.restwaste_to_dRDF.paper*dRDF.fe_metal.paper);
            
            % Glass fraction
            obj.fe_metal_recovered.glass = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.glass*cRDF.fe_metal.glass+...
                obj.restwaste_to_dRDF.glass*dRDF.fe_metal.glass);
            
            % Ferrous Metal fraction
            obj.fe_metal_recovered.fe_metal = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.fe_metal*cRDF.fe_metal.fe_metal+...
                obj.restwaste_to_dRDF.fe_metal*dRDF.fe_metal.fe_metal);
            
            % Non-Ferrous Metal fraction
            obj.fe_metal_recovered.nonfe_metal = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.nonfe_metal*cRDF.fe_metal.nonfe_metal+...
                obj.restwaste_to_dRDF.nonfe_metal*dRDF.fe_metal.nonfe_metal);
            
            % Film Plastic fraction
            obj.fe_metal_recovered.filmplastic = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.filmplastic*cRDF.fe_metal.filmplastic+...
                obj.restwaste_to_dRDF.filmplastic*dRDF.fe_metal.filmplastic);
            
            % Rigid Plastic fraction
            obj.fe_metal_recovered.rigidplastic = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.rigidplastic*cRDF.fe_metal.rigidplastic+...
                obj.restwaste_to_dRDF.rigidplastic*dRDF.fe_metal.rigidplastic);
            
            % Textiles fraction
            obj.fe_metal_recovered.textiles = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.textiles*cRDF.fe_metal.textiles+...
                obj.restwaste_to_dRDF.textiles*dRDF.fe_metal.textiles);
            
            % Organics fraction
            obj.fe_metal_recovered.organics = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.organics*cRDF.fe_metal.organics+...
                obj.restwaste_to_dRDF.organics*dRDF.fe_metal.organics);
            
            % Other fraction
            obj.fe_metal_recovered.other = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.other*cRDF.fe_metal.other+...
                obj.restwaste_to_dRDF.other*dRDF.fe_metal.other);
            
            %% Determine amount of non-ferrous metal recovered
            % Calculated by waste stream for both cRDF and dRDF combined
            
            % Paper fraction
            obj.nonfe_metal_recovered.paper = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.paper*cRDF.nonfe_metal.paper+...
                obj.restwaste_to_dRDF.paper*dRDF.nonfe_metal.paper);
            
            % Glass fraction
            obj.nonfe_metal_recovered.glass = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.glass*cRDF.nonfe_metal.glass+...
                obj.restwaste_to_dRDF.glass*dRDF.nonfe_metal.glass);
            
            % Ferrous Metal fraction
            obj.nonfe_metal_recovered.fe_metal = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.fe_metal*cRDF.nonfe_metal.fe_metal+...
                obj.restwaste_to_dRDF.fe_metal*dRDF.nonfe_metal.fe_metal);
            
            % Non-Ferrous Metal fraction
            obj.nonfe_metal_recovered.nonfe_metal = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.nonfe_metal*cRDF.nonfe_metal.nonfe_metal+...
                obj.restwaste_to_dRDF.nonfe_metal*dRDF.nonfe_metal.nonfe_metal);
            
            % Film Plastic fraction
            obj.nonfe_metal_recovered.filmplastic = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.filmplastic*cRDF.nonfe_metal.filmplastic+...
                obj.restwaste_to_dRDF.filmplastic*dRDF.nonfe_metal.filmplastic);
            
            % Rigid Plastic fraction
            obj.nonfe_metal_recovered.rigidplastic = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.rigidplastic*cRDF.nonfe_metal.rigidplastic+...
                obj.restwaste_to_dRDF.rigidplastic*dRDF.nonfe_metal.rigidplastic);
            
            % Textiles fraction
            obj.nonfe_metal_recovered.textiles = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.textiles*cRDF.nonfe_metal.textiles+...
                obj.restwaste_to_dRDF.textiles*dRDF.nonfe_metal.textiles);
            
            % Organics fraction
            obj.nonfe_metal_recovered.organics = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.organics*cRDF.nonfe_metal.organics+...
                obj.restwaste_to_dRDF.organics*dRDF.nonfe_metal.organics);
            
            % Other fraction
            obj.nonfe_metal_recovered.other = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.other*cRDF.nonfe_metal.other+...
                obj.restwaste_to_dRDF.other*dRDF.nonfe_metal.other);
            
            %% Determine amount of fines generated from the RDF sorting process and their resulting destinations
            % Either biological treatment or landfill
            % Here, the values resulting from cRDF and dRDF sorting will be
            % combined
            
            % Paper fraction
            obj.fines_to_biological.paper = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.paper*cRDF.fines.paper*...
                sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment')+...
                obj.restwaste_to_dRDF.paper*dRDF.fines.paper*...
                sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment'));
            
            obj.fines_to_landfill.paper = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.paper*cRDF.fines.paper*...
                (1-sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment'))+...
                obj.restwaste_to_dRDF.paper*dRDF.fines.paper*...
                (1-sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment')));
            
            % Glass fraction
            obj.fines_to_biological.glass = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.glass*cRDF.fines.glass*...
                sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment')+...
                obj.restwaste_to_dRDF.glass*dRDF.fines.glass*...
                sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment'));
            
            obj.fines_to_landfill.glass = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.glass*cRDF.fines.glass*...
                (1-sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment'))+...
                obj.restwaste_to_dRDF.glass*dRDF.fines.glass*...
                (1-sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment')));
            
            % Ferrous metal fraction
            obj.fines_to_biological.fe_metal = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.fe_metal*cRDF.fines.fe_metal*...
                sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment')+...
                obj.restwaste_to_dRDF.fe_metal*dRDF.fines.fe_metal*...
                sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment'));
            
            obj.fines_to_landfill.fe_metal = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.fe_metal*cRDF.fines.fe_metal*...
                (1-sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment'))+...
                obj.restwaste_to_dRDF.fe_metal*dRDF.fines.fe_metal*...
                (1-sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment')));
            
            % Non-ferrous metal fraction
            obj.fines_to_biological.nonfe_metal = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.nonfe_metal*cRDF.fines.nonfe_metal*...
                sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment')+...
                obj.restwaste_to_dRDF.nonfe_metal*dRDF.fines.nonfe_metal*...
                sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment'));
            
            obj.fines_to_landfill.nonfe_metal = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.nonfe_metal*cRDF.fines.nonfe_metal*...
                (1-sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment'))+...
                obj.restwaste_to_dRDF.nonfe_metal*dRDF.fines.nonfe_metal*...
                (1-sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment')));
            
            % Film plastic fraction
            obj.fines_to_biological.filmplastic = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.filmplastic*cRDF.fines.filmplastic*...
                sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment')+...
                obj.restwaste_to_dRDF.filmplastic*dRDF.fines.filmplastic*...
                sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment'));
            
            obj.fines_to_landfill.filmplastic = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.filmplastic*cRDF.fines.filmplastic*...
                (1-sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment'))+...
                obj.restwaste_to_dRDF.filmplastic*dRDF.fines.filmplastic*...
                (1-sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment')));
            
            % Rigid plastic fraction
            obj.fines_to_biological.rigidplastic = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.rigidplastic*cRDF.fines.rigidplastic*...
                sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment')+...
                obj.restwaste_to_dRDF.rigidplastic*dRDF.fines.rigidplastic*...
                sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment'));
            
            obj.fines_to_landfill.rigidplastic = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.rigidplastic*cRDF.fines.rigidplastic*...
                (1-sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment'))+...
                obj.restwaste_to_dRDF.rigidplastic*dRDF.fines.rigidplastic*...
                (1-sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment')));
            
            % Textiles fraction
            obj.fines_to_biological.textiles = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.textiles*cRDF.fines.textiles*...
                sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment')+...
                obj.restwaste_to_dRDF.textiles*dRDF.fines.textiles*...
                sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment'));
            
            obj.fines_to_landfill.textiles = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.textiles*cRDF.fines.textiles*...
                (1-sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment'))+...
                obj.restwaste_to_dRDF.textiles*dRDF.fines.textiles*...
                (1-sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment')));
            
            % Organic fraction
            obj.fines_to_biological.organics = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.organics*cRDF.fines.organics*...
                sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment')+...
                obj.restwaste_to_dRDF.organics*dRDF.fines.organics*...
                sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment'));
            
            obj.fines_to_landfill.organics = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.organics*cRDF.fines.organics*...
                (1-sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment'))+...
                obj.restwaste_to_dRDF.organics*dRDF.fines.organics*...
                (1-sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment')));
            
            % Other fraction
            obj.fines_to_biological.other = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.other*cRDF.fines.other*...
                sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment')+...
                obj.restwaste_to_dRDF.other*dRDF.fines.other*...
                sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment'));
            
            obj.fines_to_landfill.other = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.other*cRDF.fines.other*...
                (1-sorting.GetNodeTypeAttributeValue('cRDFFinestoBiologicalTreatment'))+...
                obj.restwaste_to_dRDF.other*dRDF.fines.other*...
                (1-sorting.GetNodeTypeAttributeValue('dRDFFinestoBiologicalTreatment')));
                        
            %% Determine residues sent to landfill
            % Calculated by waste stream for both cRDF and dRDF combined
            
            % Paper fraction
            obj.residues_to_landfill.paper = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.paper*cRDF.residue.paper+...
                obj.restwaste_to_dRDF.paper*dRDF.residue.paper);
            
            % Glass fraction
            obj.residues_to_landfill.glass = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.glass*cRDF.residue.glass+...
                obj.restwaste_to_dRDF.glass*dRDF.residue.glass);
            
            % Ferrous Metal fraction
            obj.residues_to_landfill.fe_metal = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.fe_metal*cRDF.residue.fe_metal+...
                obj.restwaste_to_dRDF.fe_metal*dRDF.residue.fe_metal);
            
            % Non-Ferrous Metal fraction
            obj.residues_to_landfill.nonfe_metal = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.nonfe_metal*cRDF.residue.nonfe_metal+...
                obj.restwaste_to_dRDF.nonfe_metal*dRDF.residue.nonfe_metal);
            
            % Film Plastic fraction
            obj.residues_to_landfill.filmplastic = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.filmplastic*cRDF.residue.filmplastic+...
                obj.restwaste_to_dRDF.filmplastic*dRDF.residue.filmplastic);
            
            % Rigid Plastic fraction
            obj.residues_to_landfill.rigidplastic = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.rigidplastic*cRDF.residue.rigidplastic+...
                obj.restwaste_to_dRDF.rigidplastic*dRDF.residue.rigidplastic);
            
            % Textiles fraction
            obj.residues_to_landfill.textiles = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.textiles*cRDF.residue.textiles+...
                obj.restwaste_to_dRDF.textiles*dRDF.residue.textiles);
            
            % Organics fraction
            obj.residues_to_landfill.organics = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.organics*cRDF.residue.organics+...
                obj.restwaste_to_dRDF.organics*dRDF.residue.organics);
            
            % Other fraction
            obj.residues_to_landfill.other = (1-sorting.GetNodeTypeAttributeValue('rdfPercentWasteRejected'))*...
                (1-sorting.GetNodeTypeAttributeValue('rdfPercentRogueItemsRejected'))*...
                (obj.restwaste_to_cRDF.other*cRDF.residue.other+...
                obj.restwaste_to_dRDF.other*dRDF.residue.other);

            %% Assign total RDF extracted to val
            val = obj.cRDF_extracted + obj.dRDF_extracted;
            
        end
    end
end